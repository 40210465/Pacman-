<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Basic ThreeJS APP</title>
    <style>
        body {
            /* set margin to 0 and overflow to hidden, to use the complete page */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <!-- HTML body will hold the Output -->

    <script type="module">
        import * as THREE from './libs/three.module.js';

        let camera, scene, renderer;
        let shoulder, elbow; // PIVOTS (Object3D)

        let material;

        let shoulderXup, shoulderXdown, shoulderZup, shoulderZdown = false
        let elbowZup, elbowZdown = false

        // once everything is loaded, we run our Three.js stuff
        window.onload = function init() {

            // create an empty scene, that will hold all our elements such as objects, cameras and lights
            scene = new THREE.Scene();

            // create a camera, which defines where we're looking at
            const aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 10);
            camera.position.y = 2;
            camera.position.z = 5;
            camera.lookAt(scene.position); //point the camera to the center of the scene


            // create a render and set the size
            renderer = new THREE.WebGLRenderer({ antialias: false }); // aliasing (jagged edges when rendering)
            renderer.setSize(window.innerWidth, window.innerHeight);
            // configure renderer clear color
            renderer.setClearColor("#000000");

            // add the output of the renderer to an HTML element (this case, the body)
            document.body.appendChild(renderer.domElement);


            /**********************************************************************************
             * ROBOTIC ARM: SHOULDER (pivot) -> ARM (mesh) -> ELBOW (pivot) -> FOREARM (mesh)
             * ********************************************************************************/
            // define a parallelepiped geometry and a normal material for the meshes (arm & forearm)
            let geometry = new THREE.BoxGeometry(2, 1, 1);
            material = new THREE.MeshNormalMaterial({ wireframe: false });

            /* SHOULDER */
            shoulder = new THREE.Object3D();
            shoulder.position.set(-2, 0, 0)
            scene.add(shoulder); // place the shoulder aligned with the world CS

            // // show axes for the SHOULDER CS
            // let axesShoulder = new THREE.AxesHelper(4);
            // shoulder.add(axesShoulder);


            /* ARM */
            let arm = new THREE.Mesh(geometry, material);
            arm.position.x = 1
            // add the ARM to the SHOULDER
            shoulder.add(arm);

            // // show axes for the ARM CS
            // let axesArm = new THREE.AxesHelper(2);
            // arm.add(axesArm);


            /* ELBOW */
            elbow = new THREE.Object3D();
            arm.add(elbow); // add the ELBOW to the ARM
            elbow.position.x = 1

            // // show axes for the SHOULDER CS
            // let axesElbow = new THREE.AxesHelper(4);
            // elbow.add(axesElbow);


            /* FOREARM */
            let forearm = new THREE.Mesh(geometry, material);
            forearm.position.x = 1
            // add the FOREARM to the ELBOW
            elbow.add(forearm);

            // // show axes for the FOREARM CS
            // let axesForearm = new THREE.AxesHelper(2);
            // forearm.add(axesForearm);


            /*****************************
             * ANIMATE 
             * ***************************/
            // set the animation function
            renderer.setAnimationLoop(render);
        }

        /*****************************
        * ANIMATION FUNCTION 
        * ***************************/
        function render() {
            // rotate the shoulder around its X-axis (on key R)
            if (shoulderXup)
                shoulder.rotation.x += 0.01;
            else if (shoulderXdown)
                shoulder.rotation.x -= 0.01;

            // rotate the shoulder around its Z-axis (on key S)
            if (shoulderZup) {
                if (shoulder.rotation.z < THREE.Math.degToRad(90))
                    shoulder.rotation.z += 0.01;
            }
            if (shoulderZdown) {
                if (shoulder.rotation.z > THREE.Math.degToRad(-90))
                    shoulder.rotation.z -= 0.01;
            }

            // rotate the elbow around its Z-axis (on key E)
            if (elbowZup) {
                if (elbow.rotation.z < THREE.Math.degToRad(145))
                    elbow.rotation.z += 0.01;
            }
            if (elbowZdown) {
                if (elbow.rotation.z > THREE.Math.degToRad(0))
                    elbow.rotation.z -= 0.01;
            }

            // render the scene into viewport using the camera
            renderer.render(scene, camera);
        }


        /*****************************
        * KEYBOARD EVENTS 
        * ***************************/
        document.addEventListener("keydown", event => {
            if (event.key == 'r') {
                shoulderXup = true;
            }
            else if (event.key == 'R') {
                shoulderXdown = true;
            }

            if (event.key == 's') {
                shoulderZup = true;
            }
            else if (event.key == 'S') {
                shoulderZdown = true;
            }

            if (event.key == 'e') {
                elbowZup = true;
            }
            else if (event.key == 'E') {
                elbowZdown = true;
            }

            if (event.key == 't') {
                // elbow.children[1].material.wireframe = !elbow.children[1].material.wireframe;
                material.wireframe = !material.wireframe;
                // HINT: inspect elbow object with console.log(elbow)
            }
        })

        document.addEventListener("keyup", event => {
            if (event.key == 'r' || event.key == 'R') {
                shoulderXup = shoulderXdown = false;
            }

            if (event.key == 's' || event.key == 'S') {
                shoulderZup = shoulderZdown = false;
            }

            if (event.key == 'e' || event.key == 'E') {
                elbowZup = elbowZdown = false;
            }
        })

    </script>
</body>

</html>